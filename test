Sub ExtractPXNestedElements()
    Dim fso As Object, jsonFile As Object
    Dim regEx As Object, matches As Object
    Dim jsonText As String, filePath As Variant
    Dim wsMapping As Worksheet
    Dim lastRow As Long, i As Long
    Dim targetName As String, pattern As String

    Set wsMapping = ThisWorkbook.Sheets("Mapping")
    
    ' 1. Select the JSON file
    filePath = Application.GetOpenFilename("JSON Files (*.json), *.json")
    If filePath = False Then Exit Sub
    
    ' 2. Read File
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set jsonFile = fso.OpenTextFile(filePath, 1)
    jsonText = jsonFile.ReadAll
    jsonFile.Close

    ' 3. Setup RegEx
    Set regEx = CreateObject("VBScript.RegExp")
    regEx.Global = False
    regEx.IgnoreCase = True
    
    lastRow = wsMapping.Cells(wsMapping.Rows.Count, "A").End(xlUp).Row
    
    ' 4. Loop through Column A (e.g., "annualPremium", "sumAssured")
    For i = 2 To lastRow
        targetName = wsMapping.Cells(i, 1).Value
        
        ' This advanced pattern finds the NAME and then looks ahead 
        ' for the very next VALUE regardless of line breaks.
        regEx.Pattern = """name""\s*:\s*""" & targetName & """[\s\S]*?""value""\s*:\s*""?([^"",}]+)""?"
        
        If regEx.Test(jsonText) Then
            Set matches = regEx.Execute(jsonText)
            wsMapping.Cells(i, 2).Value = Trim(matches(0).SubMatches(0))
        Else
            wsMapping.Cells(i, 2).Value = "NOT FOUND"
        End If
    Next i
    
    MsgBox "Extraction Complete for " & lastRow - 1 & " elements!", vbInformation
End Sub
